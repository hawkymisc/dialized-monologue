# TDD: Red → Green → Refactor → Feedback

## サイクル図

```
┌─────────────────────────────────────────────────────────────┐
│  1. RED: 失敗するテストを書く                                │
│     - 期待する振る舞いを明確にする                           │
│     - テストが失敗することを確認                             │
├─────────────────────────────────────────────────────────────┤
│  2. GREEN: 最小限のコードでテストを通す                      │
│     - 「動く」ことだけを目指す                               │
│     - 美しさや効率は後回し                                   │
├─────────────────────────────────────────────────────────────┤
│  3. REFACTOR: コードを改善する ← ここを省略しない！          │
│     - 重複の除去                                             │
│     - 命名の改善                                             │
│     - 責務の分離                                             │
│     - テストも必要に応じてリファクタ                         │
├─────────────────────────────────────────────────────────────┤
│  4. FEEDBACK: 設計への気づきを反映する ← TDDの本質的価値     │
│     - 「このインターフェースは使いにくい」→ 型定義を修正     │
│     - 「この責務はここにない方がいい」→ モジュール分割       │
│     - 「このテストは書きにくい」→ 設計に問題がある兆候       │
│     - SPEC.mdや型定義への変更を積極的に行う                  │
└─────────────────────────────────────────────────────────────┘
```

## Refactorを省略しない

Claudeは一発で動くコードを書きがちだが、TDDの本質的価値は
「実装しながらの気づきによる設計へのフィードバック」である。

## Refactor/Feedbackチェックリスト

各機能実装後、以下を確認する：

- [ ] 重複コードはないか？
- [ ] 関数/クラスの責務は単一か？
- [ ] 命名は意図を正確に表しているか？
- [ ] テストは読みやすく、意図が明確か？
- [ ] 実装して気づいた設計の問題点はないか？
- [ ] 型定義やインターフェースに改善点はないか？
- [ ] SPEC.mdに追記すべき仕様の気づきはないか？

## テストが書きにくい = 設計の問題

テストが書きにくいと感じたら、それは設計に問題がある兆候。
無理にテストを書くのではなく、設計を見直す。
