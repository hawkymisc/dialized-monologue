# dialized-monologue 仕様書

## 概要

**dialized-monologue**は、毎日決まった時間にリマインダー通知を送り、質問に答える形式で日記を記録できるモバイルアプリケーションです。音声入力に対応し、手軽に日々の振り返りを行えます。

## ターゲットユーザー

- 日記を習慣化したいが続かない人
- 文章を書くのが苦手だが、質問に答える形式なら取り組みやすい人
- 音声入力で素早く記録したい人

---

## 機能仕様

### 1. リマインダー機能

#### 1.1 通知スケジュール
- ユーザーが任意の時刻を設定可能
- 複数の時刻を設定可能（例：朝7時、夜21時）
- 曜日ごとの設定も可能（将来拡張）

#### 1.2 通知内容
- タイトル: 「日記の時間です」
- 本文: 「今日を振り返りましょう」
- 通知タップでアプリが起動し、日記入力画面を表示

#### 1.3 技術仕様
- `expo-notifications` を使用
- ローカル通知（プッシュサーバー不要）
- バックグラウンドでもスケジュール実行

### 2. 日記入力機能

#### 2.1 質問形式
日記は質問に順番に回答する形式で記録する。

**デフォルト質問セット:**
1. 今日の気分は？（5段階 + 自由記述）
2. 今日あった良いことは？
3. 今日学んだこと・気づいたことは？
4. 明日の目標は？

#### 2.2 質問カスタマイズ
- ユーザーが質問を追加・編集・削除可能
- 質問の順番を変更可能
- 質問ごとに回答形式を選択可能:
  - テキスト（単一行）
  - テキスト（複数行）
  - 5段階評価
  - 選択肢

#### 2.3 入力方法
- テキスト入力（キーボード）
- 音声入力（マイクボタンで切替）
- 両方を同一回答内で混在可能

### 3. 音声入力機能

#### 3.1 基本動作
- マイクボタンタップで録音開始
- 再度タップまたは無音検知で録音終了
- リアルタイムで文字起こし表示
- 認識結果をテキストフィールドに挿入

#### 3.2 技術仕様
- OS標準の音声認識API使用（`@react-native-voice/voice`）
- オフライン対応（OSの音声認識がオフライン対応している場合）
- 対応言語: 日本語（デバイス設定に依存）

#### 3.3 エラーハンドリング
- マイク権限がない場合: 権限リクエストダイアログを表示
- 認識失敗時: エラーメッセージ表示、手動入力を促す

### 4. データ管理

#### 4.1 保存形式
```typescript
interface DiaryEntry {
  id: string;                    // UUID
  date: string;                  // ISO 8601形式 (YYYY-MM-DD)
  createdAt: string;             // ISO 8601形式
  updatedAt: string;             // ISO 8601形式
  answers: DiaryAnswer[];        // 回答一覧
}

interface DiaryAnswer {
  questionId: string;            // 質問ID
  questionText: string;          // 質問テキスト（スナップショット）
  value: string | number;        // 回答値
  type: 'text' | 'rating';       // 回答タイプ
}

interface Question {
  id: string;                    // UUID
  text: string;                  // 質問文
  type: 'text' | 'multiline' | 'rating' | 'choice';
  options?: string[];            // choice型の場合の選択肢
  order: number;                 // 表示順
  isActive: boolean;             // 有効/無効
}
```

#### 4.2 ストレージ
- `@react-native-async-storage/async-storage` 使用
- キー構造:
  - `diary_entries`: 日記エントリー配列
  - `questions`: 質問配列
  - `settings`: アプリ設定

#### 4.3 エクスポート
- JSON形式: 完全なデータバックアップ
- CSV形式: 表計算ソフトで閲覧可能な形式
- 共有シート経由でファイル保存/送信

### 5. 日記閲覧機能

#### 5.1 一覧表示
- 日付降順でリスト表示
- 各日の気分アイコン表示
- プレビュー（最初の回答の一部）

#### 5.2 詳細表示
- 選択した日の全回答を表示
- 編集可能

#### 5.3 検索
- キーワードで過去の日記を検索
- 日付範囲フィルター

### 6. 設定機能

#### 6.1 リマインダー設定
- 通知時刻の追加/編集/削除
- 通知ON/OFF切替

#### 6.2 質問設定
- 質問の追加/編集/削除
- 順番変更
- デフォルト質問へのリセット

#### 6.3 データ管理
- エクスポート（JSON/CSV）
- 全データ削除（確認ダイアログ付き）

#### 6.4 表示設定
- ダークモード（システム設定に従う / 手動切替）

---

## 画面構成

### 画面一覧
1. **ホーム画面** - 今日の日記入力 / 過去の日記一覧
2. **日記入力画面** - 質問に順番に回答
3. **日記詳細画面** - 過去の日記閲覧/編集
4. **設定画面** - 各種設定

### 画面遷移
```
[ホーム] ─┬─> [日記入力] ─> [完了] ─> [ホーム]
          │
          ├─> [日記詳細] ─> [編集] ─> [保存] ─> [日記詳細]
          │
          └─> [設定] ─┬─> [リマインダー設定]
                      ├─> [質問設定]
                      └─> [データ管理]
```

---

## 非機能要件

### パフォーマンス
- アプリ起動: 2秒以内
- 画面遷移: 300ms以内
- 日記保存: 500ms以内

### セキュリティ
- データはローカルのみに保存
- 外部サーバーへのデータ送信なし
- バイオメトリクス認証は将来検討

### アクセシビリティ
- VoiceOver/TalkBack対応
- 十分なコントラスト比
- タップ領域の適切なサイズ

### 対応OS
- iOS 13.0以上
- Android 8.0 (API 26) 以上

---

## 技術仕様

### フレームワーク
- React Native + Expo (Managed Workflow)
- TypeScript

### 主要ライブラリ

| ライブラリ | バージョン | 用途 | 実装状況 |
|-----------|-----------|------|----------|
| expo | ~54.0.31 | フレームワーク | ✅ |
| expo-notifications | ~0.32.16 | 通知 | ✅ |
| expo-file-system | ~19.0.21 | ファイルシステム | ✅ |
| expo-sharing | ~14.0.8 | ファイル共有 | ✅ |
| @react-native-async-storage/async-storage | 2.2.0 | ストレージ | ✅ |
| @react-navigation/native | ^7.1.27 | ナビゲーション | ⏳ |
| @react-navigation/native-stack | ^7.9.1 | スタックナビゲーション | ⏳ |
| zustand | ^5.0.10 | 状態管理 | ✅ |
| date-fns | ^4.1.0 | 日付操作 | ✅ |
| react | 19.1.0 | UIライブラリ | ✅ |
| react-native | 0.81.5 | モバイルフレームワーク | ✅ |

**注意**: 音声認識は当初 `@react-native-voice/voice` を予定していましたが、実装では `expo-speech` の使用も検討中。

### ディレクトリ構造

```
src/
├── components/       # 再利用可能なUIコンポーネント
│   ├── Button.tsx             ✅ 実装済み
│   ├── TextInput.tsx          ✅ 実装済み
│   ├── ListItem.tsx           ✅ 実装済み
│   ├── VoiceInputButton.tsx   ✅ 実装済み
│   ├── Card.tsx               ✅ 実装済み
│   └── ...
├── screens/          # 画面コンポーネント
│   ├── HomeScreen.tsx         ⏳ 未実装
│   ├── DiaryInputScreen.tsx   ⏳ 未実装
│   ├── DiaryDetailScreen.tsx  ⏳ 未実装
│   └── SettingsScreen.tsx     ⏳ 未実装
├── hooks/            # カスタムフック
│   ├── useVoiceRecognition.ts ⏳ 未実装
│   └── ...
├── stores/           # Zustand ストア
│   ├── diaryStore.ts          ✅ 実装済み
│   ├── questionStore.ts       ✅ 実装済み
│   └── settingsStore.ts       ✅ 実装済み
├── services/         # 外部サービス連携
│   ├── storage.ts             ✅ 実装済み
│   ├── notification.ts        ✅ 実装済み
│   ├── speech.ts              ✅ 実装済み
│   └── export.ts              ✅ 実装済み
├── types/            # 型定義
│   └── index.ts               ✅ 実装済み
├── utils/            # ユーティリティ
│   └── date.ts                ✅ 実装済み
└── constants/        # 定数
    └── defaultQuestions.ts    ✅ 実装済み
```

**実装状況**:
- ✅ 基盤層（型定義、ストレージ、サービス層、ストア）: 完了
- ✅ UIコンポーネント: 完了（5コンポーネント）
- ⏳ 画面コンポーネント: 未実装
- ⏳ カスタムフック: 未実装

詳細は [COMPONENTS.md](./COMPONENTS.md) を参照。

---

## 将来の拡張（スコープ外）

- クラウド同期（複数端末対応）
- AI による日記分析・サマリー
- 写真添付
- 位置情報記録
- ウィジェット対応
- Apple Watch / WearOS対応
